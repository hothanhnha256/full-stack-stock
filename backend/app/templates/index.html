{% extends 'layout.html' %} {% block title %}Qu·∫£n l√Ω m√£ ch·ª©ng kho√°n{% endblock
%} {% block content %}
<h1 class="mb-4">Qu·∫£n l√Ω danh s√°ch m√£ ch·ª©ng kho√°n</h1>

<form method="post" class="row g-2 mb-4" id="search-form">
  <input type="hidden" name="action" value="add" />
  <div class="col-md-6">
    <input
      type="text"
      name="code"
      id="symbol-input"
      class="form-control"
      placeholder="T√¨m m√£ (VD: VNM, FPT, Ho√† Ph√°t)"
      autocomplete="off"
    />
    <div
      class="list-group"
      id="suggestions"
      style="position: absolute; z-index: 1000"
    ></div>
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-success">Th√™m</button>
  </div>
</form>

<table class="table table-striped">
  <thead>
    <tr>
      <th>#</th>
      <th>M√£</th>
      <th>Ng√†y th√™m</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
  </thead>
  <tbody>
    {% for sym in symbols %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ sym.code }}</td>
      <td>{{ sym.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
      <td>
        <form method="post" style="display: inline">
          <input type="hidden" name="action" value="delete" />
          <input type="hidden" name="symbol_id" value="{{ sym.id }}" />
          <button
            type="submit"
            class="btn btn-sm btn-danger"
            onclick="return confirm('X√°c nh·∫≠n x√≥a {{ sym.code }}?');"
          >
            X√≥a
          </button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="4" class="text-center">Ch∆∞a c√≥ m√£ n√†o.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<form method="post" class="mt-4" id="send-report-form">
  <input type="hidden" name="action" value="send" />
  <button type="submit" class="btn btn-primary btn-lg" id="send-btn">
    <span id="btn-text">üìä G·ª≠i b√°o c√°o ngay</span>
    <span id="btn-loading" style="display: none">
      <span
        class="spinner-border spinner-border-sm me-2"
        role="status"
        aria-hidden="true"
      ></span>
      ƒêang x·ª≠ l√Ω... (c√≥ th·ªÉ m·∫•t 30-60 gi√¢y)
    </span>
  </button>
</form>

<div
  id="loading-overlay"
  style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999;
  "
>
  <div
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
    "
  >
    <div
      class="spinner-border text-light mb-3"
      style="width: 4rem; height: 4rem"
      role="status"
    >
      <span class="visually-hidden">Loading...</span>
    </div>
    <h4>‚è≥ ƒêang t·∫°o b√°o c√°o...</h4>
    <p>ƒêang l·∫•y d·ªØ li·ªáu t·ª´ FireAnt (VNINDEX, HNXINDEX)</p>
    <p class="text-warning">Vui l√≤ng ch·ªù kho·∫£ng 30-60 gi√¢y</p>
    <div class="progress mt-3" style="width: 300px; margin: 0 auto">
      <div
        class="progress-bar progress-bar-striped progress-bar-animated"
        role="progressbar"
        style="width: 100%"
      ></div>
    </div>
  </div>
</div>

<p class="text-muted mt-3">B√°o c√°o t·ª± ƒë·ªông: {{ auto_info }}</p>

<script>
  document
    .getElementById("send-report-form")
    .addEventListener("submit", function (e) {
      const btnText = document.getElementById("btn-text");
      const btnLoading = document.getElementById("btn-loading");
      const sendBtn = document.getElementById("send-btn");
      const overlay = document.getElementById("loading-overlay");

      // Hi·ªán loading
      btnText.style.display = "none";
      btnLoading.style.display = "inline";
      sendBtn.disabled = true;
      overlay.style.display = "block";

      // Form s·∫Ω submit b√¨nh th∆∞·ªùng, loading s·∫Ω t·∫Øt khi page reload
    });
</script>

{% endblock %}
